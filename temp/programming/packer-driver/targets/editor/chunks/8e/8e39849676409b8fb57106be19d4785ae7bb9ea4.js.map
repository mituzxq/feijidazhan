{"version":3,"sources":["file:///C:/Users/zxq/Desktop/%E9%A3%9E%E6%9C%BA%E5%A4%A7%E6%88%98/NewProject/assets/Missile.ts"],"names":["_decorator","Component","v3","ccclass","property","Missile","moveLimit","start","node","position","nodeX","x","nodeY","y","schedule","birY","parent","getChildByName","birX","setPosition","update","deltaTime","rotation","Math","sqrt","pow","targetPos","targetRadian","atan2","targetAngle","PI","curAngle","angle","distAngle","stepAngle","angleSpeed","abs","nextRadian","cos","moveSpeed","sin","theangle","theta","eulerAngles","die","destroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, v2, Quat, v3 } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Missile')\nexport class Missile extends Component {\n    private moveLimit: number = 20;\n    start() {\n        let node = this.node.position;\n        let nodeX = node.x;\n        let nodeY = node.y;\n        this.schedule(() => {\n            let birY = this.node.parent.getChildByName(\"enemy\").position.y;\n            let birX = this.node.parent.getChildByName(\"enemy\").position.x;\n            if (nodeY < birY) {\n                this.node.setPosition(node.x, node.y + 1);\n            } else if (nodeY == birY) {\n                this.node.setPosition(node.x, node.y);\n            }\n            if (birX < 0) {\n                if (nodeX > birX) {\n                    this.node.setPosition(node.x - 1, node.y);\n                } else {\n                    this.node.setPosition(node.x, node.y);\n                }\n            } else if (birX > 0) {\n                if (nodeX < birX) {\n                    this.node.setPosition(node.x + 1, node.y);\n                } else {\n                    this.node.setPosition(node.x, node.y);\n                }\n            } else {\n                this.node.setPosition(node.x, node.y);\n            }\n        }, 0.01);\n    }\n\n    update(deltaTime: number) {\n        this.rotation();\n        if (Math.sqrt(Math.pow(this.node.x - this.targetPos.x, 2) + Math.pow(this.node.y - this.targetPos.y, 2)) > this.moveLimit) {\n            //导弹和目标点之间弧度、角度 \n            let targetRadian = Math.atan2(this.targetPos.y - this.node.y, this.targetPos.x - this.node.x);\n            let targetAngle = targetRadian * 180 / Math.PI;\n            //导弹当前角度\n            let curAngle = this.node.angle;\n            //导弹当前角度和导弹最终指向角度的差\n            let distAngle = targetAngle - curAngle;\n            //导弹转动的角速度，根据角度差来判断顺时针或逆时针。( stepAngle=null时才会计算旋转角度，为了防止导弹出现在边界值附近左右摇摆的问题，一旦确定旋转角度方向，则不再改变)\n            if (this.stepAngle == null) {\n                this.stepAngle = distAngle > 0 ? this.angleSpeed : -this.angleSpeed;\n            }\n            //临界值判断 (Math.atan2会在边界值位置直接从180变成-180，或-180变成180，导致永远到不了目标角度)\n            if (Math.abs((curAngle + 360) % 360 - (targetAngle + 360) % 360) > (Math.abs(this.stepAngle) + 1)) {\n                //角度未达到临近值才会++，防止抖动\n                if (Math.abs(this.node.angle - targetAngle) > (Math.abs(this.stepAngle) + 1)) {\n                    this.node.angle += this.stepAngle;\n                }\n            }\n            //移动\n            let nextRadian = this.node.angle * Math.PI / 180;\n            this.node.x += Math.cos(nextRadian) * this.moveSpeed;\n            this.node.y += Math.sin(nextRadian) * this.moveSpeed;\n        }\n\n    }\n    //旋转\n    rotation() {\n        if (Math.sqrt(Math.pow(this.node.position.x - this.node.parent.getChildByName(\"enemy\").position.x, 2) +\n            Math.pow(this.node.position.y - this.node.parent.getChildByName(\"enemy\").position.y, 2)) > this.moveLimit) {\n            let theangle = Math.atan2(this.node.position.y - this.node.parent.getChildByName(\"enemy\").position.y,\n                this.node.position.x - this.node.parent.getChildByName(\"enemy\").position.x);\n            let theta = theangle * 180 / Math.PI;\n            this.node.eulerAngles = v3(0, 0, theta);\n        }\n    }\n    die() {\n        this.node.destroy();\n    }\n}\n\n"]}