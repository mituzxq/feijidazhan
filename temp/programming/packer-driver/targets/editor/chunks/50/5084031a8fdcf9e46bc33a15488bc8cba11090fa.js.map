{"version":3,"sources":["file:///C:/Users/zxq/Desktop/%E9%A3%9E%E6%9C%BA%E5%A4%A7%E6%88%98/NewProject/assets/Missile.ts"],"names":["_decorator","Component","v3","Vec2","ccclass","property","Missile","targetPos","angleSpeed","moveSpeed","moveLimit","stepAngle","setTargetPos","xPos","yPos","x","y","reset","start","node","position","nodeX","nodeY","schedule","birY","parent","getChildByName","birX","setPosition","update","deltaTime","rotation","Math","sqrt","pow","theangle","atan2","theta","PI","curAngle","angle","distAngle","eulerAngles","abs","nextRadian","cos","sin","die","destroy"],"mappings":";;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAA2BC,MAAAA,E,OAAAA,E;AAAIC,MAAAA,I,OAAAA,I;;;;;;;OAC9C;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;;yBAGjBM,O,WADZF,OAAO,CAAC,SAAD,C,gBAAR,MACaE,OADb,SAC6BL,SAD7B,CACuC;AAAA;AAAA;AAAA,eAE5BM,SAF4B,GAEV,IAAIJ,IAAJ,EAFU;AAAA,eAI5BK,UAJ4B,GAIP,CAJO;AAAA,eAM5BC,SAN4B,GAMR,CANQ;AAAA,eAS3BC,SAT2B,GASP,EATO;AAAA,eAW3BC,SAX2B,GAWP,IAXO;AAAA;;AAa5BC,QAAAA,YAAY,CAACC,IAAD,EAAeC,IAAf,EAA6B;AAC5C,eAAKP,SAAL,CAAeQ,CAAf,GAAmBF,IAAnB;AACA,eAAKN,SAAL,CAAeS,CAAf,GAAmBF,IAAnB;AACA,eAAKH,SAAL,GAAiB,IAAjB;AACH;AAED;;;AACOM,QAAAA,KAAK,GAAG;AACX,eAAKN,SAAL,GAAiB,IAAjB;AACH;;AACDO,QAAAA,KAAK,GAAG;AACJ,cAAIC,IAAI,GAAG,KAAKA,IAAL,CAAUC,QAArB;AACA,cAAIC,KAAK,GAAGF,IAAI,CAACJ,CAAjB;AACA,cAAIO,KAAK,GAAGH,IAAI,CAACH,CAAjB;AACA,eAAKO,QAAL,CAAc,MAAM;AAChB,gBAAIC,IAAI,GAAG,KAAKL,IAAL,CAAUM,MAAV,CAAiBC,cAAjB,CAAgC,OAAhC,EAAyCN,QAAzC,CAAkDJ,CAA7D;AACA,gBAAIW,IAAI,GAAG,KAAKR,IAAL,CAAUM,MAAV,CAAiBC,cAAjB,CAAgC,OAAhC,EAAyCN,QAAzC,CAAkDL,CAA7D;;AACA,gBAAIO,KAAK,GAAGE,IAAZ,EAAkB;AACd,mBAAKL,IAAL,CAAUS,WAAV,CAAsBT,IAAI,CAACJ,CAA3B,EAA8BI,IAAI,CAACH,CAAL,GAAS,CAAvC;AACH,aAFD,MAEO,IAAIM,KAAK,IAAIE,IAAb,EAAmB;AACtB,mBAAKL,IAAL,CAAUS,WAAV,CAAsBT,IAAI,CAACJ,CAA3B,EAA8BI,IAAI,CAACH,CAAnC;AACH;;AACD,gBAAIW,IAAI,GAAG,CAAX,EAAc;AACV,kBAAIN,KAAK,GAAGM,IAAZ,EAAkB;AACd,qBAAKR,IAAL,CAAUS,WAAV,CAAsBT,IAAI,CAACJ,CAAL,GAAS,CAA/B,EAAkCI,IAAI,CAACH,CAAvC;AACH,eAFD,MAEO;AACH,qBAAKG,IAAL,CAAUS,WAAV,CAAsBT,IAAI,CAACJ,CAA3B,EAA8BI,IAAI,CAACH,CAAnC;AACH;AACJ,aAND,MAMO,IAAIW,IAAI,GAAG,CAAX,EAAc;AACjB,kBAAIN,KAAK,GAAGM,IAAZ,EAAkB;AACd,qBAAKR,IAAL,CAAUS,WAAV,CAAsBT,IAAI,CAACJ,CAAL,GAAS,CAA/B,EAAkCI,IAAI,CAACH,CAAvC;AACH,eAFD,MAEO;AACH,qBAAKG,IAAL,CAAUS,WAAV,CAAsBT,IAAI,CAACJ,CAA3B,EAA8BI,IAAI,CAACH,CAAnC;AACH;AACJ,aANM,MAMA;AACH,mBAAKG,IAAL,CAAUS,WAAV,CAAsBT,IAAI,CAACJ,CAA3B,EAA8BI,IAAI,CAACH,CAAnC;AACH;AACJ,WAvBD,EAuBG,IAvBH;AAwBH;;AAEDa,QAAAA,MAAM,CAACC,SAAD,EAAoB;AACtB,eAAKC,QAAL;AACH,SAvDkC,CAwDnC;;;AACAA,QAAAA,QAAQ,GAAG;AACP,cAAIC,IAAI,CAACC,IAAL,CAAUD,IAAI,CAACE,GAAL,CAAS,KAAKf,IAAL,CAAUC,QAAV,CAAmBL,CAAnB,GAAuB,KAAKI,IAAL,CAAUM,MAAV,CAAiBC,cAAjB,CAAgC,OAAhC,EAAyCN,QAAzC,CAAkDL,CAAlF,EAAqF,CAArF,IACViB,IAAI,CAACE,GAAL,CAAS,KAAKf,IAAL,CAAUC,QAAV,CAAmBJ,CAAnB,GAAuB,KAAKG,IAAL,CAAUM,MAAV,CAAiBC,cAAjB,CAAgC,OAAhC,EAAyCN,QAAzC,CAAkDJ,CAAlF,EAAqF,CAArF,CADA,IAC2F,KAAKN,SADpG,EAC+G;AAC3G,gBAAIyB,QAAQ,GAAGH,IAAI,CAACI,KAAL,CAAW,KAAKjB,IAAL,CAAUC,QAAV,CAAmBJ,CAAnB,GAAuB,KAAKG,IAAL,CAAUM,MAAV,CAAiBC,cAAjB,CAAgC,OAAhC,EAAyCN,QAAzC,CAAkDJ,CAApF,EACX,KAAKG,IAAL,CAAUC,QAAV,CAAmBL,CAAnB,GAAuB,KAAKI,IAAL,CAAUM,MAAV,CAAiBC,cAAjB,CAAgC,OAAhC,EAAyCN,QAAzC,CAAkDL,CAD9D,CAAf;AAEA,gBAAIsB,KAAK,GAAGF,QAAQ,GAAG,GAAX,GAAiBH,IAAI,CAACM,EAAlC;AACA,gBAAIC,QAAQ,GAAG,KAAKpB,IAAL,CAAUqB,KAAzB;AACA,gBAAIC,SAAS,GAAGJ,KAAK,GAAGE,QAAxB;AACA,iBAAKpB,IAAL,CAAUuB,WAAV,GAAwBxC,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAOmC,KAAP,CAA1B;;AACA,gBAAI,KAAK1B,SAAL,IAAkB,IAAtB,EAA4B;AACxB,mBAAKA,SAAL,GAAiB8B,SAAS,GAAG,CAAZ,GAAgB,KAAKjC,UAArB,GAAkC,CAAC,KAAKA,UAAzD;AACH;;AACD,gBAAIwB,IAAI,CAACW,GAAL,CAAS,CAACJ,QAAQ,GAAG,GAAZ,IAAmB,GAAnB,GAAyB,CAACF,KAAK,GAAG,GAAT,IAAgB,GAAlD,IAA0DL,IAAI,CAACW,GAAL,CAAS,KAAKhC,SAAd,IAA2B,CAAzF,EAA6F;AACzF;AACA,kBAAIqB,IAAI,CAACW,GAAL,CAAS,KAAKxB,IAAL,CAAUqB,KAAV,GAAkBH,KAA3B,IAAqCL,IAAI,CAACW,GAAL,CAAS,KAAKhC,SAAd,IAA2B,CAApE,EAAwE;AACpE,qBAAKQ,IAAL,CAAUqB,KAAV,IAAmB,KAAK7B,SAAxB;AACH;AACJ;;AACD,gBAAIiC,UAAU,GAAG,KAAKzB,IAAL,CAAUqB,KAAV,GAAkBR,IAAI,CAACM,EAAvB,GAA4B,GAA7C;AACA,gBAAIjB,KAAK,GAAG,KAAKF,IAAL,CAAUC,QAAV,CAAmBL,CAA/B;AACA,gBAAIO,KAAK,GAAG,KAAKH,IAAL,CAAUC,QAAV,CAAmBJ,CAA/B;AACAK,YAAAA,KAAK,IAAIW,IAAI,CAACa,GAAL,CAASD,UAAT,IAAuB,KAAKnC,SAArC;AACAa,YAAAA,KAAK,IAAIU,IAAI,CAACc,GAAL,CAASF,UAAT,IAAuB,KAAKnC,SAArC;AACA,iBAAKU,IAAL,CAAUS,WAAV,CAAsBP,KAAtB,EAA6BC,KAA7B;AACH;AACJ;;AACDyB,QAAAA,GAAG,GAAG;AACF,eAAK5B,IAAL,CAAU6B,OAAV;AACH;;AArFkC,O","sourcesContent":["import { _decorator, Component, Node, v2, Quat, v3, Vec2 } from 'cc';\nconst { ccclass, property } = _decorator;\n\n@ccclass('Missile')\nexport class Missile extends Component {\n    /**目标地点 */\n    public targetPos: Vec2 = new Vec2();\n    /**角速度 */\n    public angleSpeed: number = 5;\n    /**移动速度 */\n    public moveSpeed: number = 5;\n\n    /**移动限制距离，相距目的地距离>moveLimit时才会移动，防止抖动 */\n    private moveLimit: number = 20;\n    /**每帧变化的角度 */\n    private stepAngle: number = null;\n\n    public setTargetPos(xPos: number, yPos: number) {\n        this.targetPos.x = xPos;\n        this.targetPos.y = yPos;\n        this.stepAngle = null;\n    }\n\n    /**重置 */\n    public reset() {\n        this.stepAngle = null;\n    }\n    start() {\n        let node = this.node.position;\n        let nodeX = node.x;\n        let nodeY = node.y;\n        this.schedule(() => {\n            let birY = this.node.parent.getChildByName(\"enemy\").position.y;\n            let birX = this.node.parent.getChildByName(\"enemy\").position.x;\n            if (nodeY < birY) {\n                this.node.setPosition(node.x, node.y + 1);\n            } else if (nodeY == birY) {\n                this.node.setPosition(node.x, node.y);\n            }\n            if (birX < 0) {\n                if (nodeX > birX) {\n                    this.node.setPosition(node.x - 1, node.y);\n                } else {\n                    this.node.setPosition(node.x, node.y);\n                }\n            } else if (birX > 0) {\n                if (nodeX < birX) {\n                    this.node.setPosition(node.x + 1, node.y);\n                } else {\n                    this.node.setPosition(node.x, node.y);\n                }\n            } else {\n                this.node.setPosition(node.x, node.y);\n            }\n        }, 0.01);\n    }\n\n    update(deltaTime: number) {\n        this.rotation();\n    }\n    //旋转\n    rotation() {\n        if (Math.sqrt(Math.pow(this.node.position.x - this.node.parent.getChildByName(\"enemy\").position.x, 2) +\n            Math.pow(this.node.position.y - this.node.parent.getChildByName(\"enemy\").position.y, 2)) > this.moveLimit) {\n            let theangle = Math.atan2(this.node.position.y - this.node.parent.getChildByName(\"enemy\").position.y,\n                this.node.position.x - this.node.parent.getChildByName(\"enemy\").position.x);\n            let theta = theangle * 180 / Math.PI;\n            let curAngle = this.node.angle;\n            let distAngle = theta - curAngle;\n            this.node.eulerAngles = v3(0, 0, theta);\n            if (this.stepAngle == null) {\n                this.stepAngle = distAngle > 0 ? this.angleSpeed : -this.angleSpeed;\n            }\n            if (Math.abs((curAngle + 360) % 360 - (theta + 360) % 360) > (Math.abs(this.stepAngle) + 1)) {\n                //角度未达到临近值才会++，防止抖动\n                if (Math.abs(this.node.angle - theta) > (Math.abs(this.stepAngle) + 1)) {\n                    this.node.angle += this.stepAngle;\n                }\n            }\n            let nextRadian = this.node.angle * Math.PI / 180;\n            let nodeX = this.node.position.x;\n            let nodeY = this.node.position.y;\n            nodeX += Math.cos(nextRadian) * this.moveSpeed;\n            nodeY += Math.sin(nextRadian) * this.moveSpeed;\n            this.node.setPosition(nodeX, nodeY);\n        }\n    }\n    die() {\n        this.node.destroy();\n    }\n}\n\n"]}